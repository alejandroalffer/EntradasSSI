= Secuencia de interacciones
:author: Jesus Ruiz
:email: hesus.ruiz@gmail.com
:revnumber: 0.1
:revdate: 16-08-2019
:numbered:
:imagesdir: assets
:icons: font
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

(Version: {revnumber}, Version Date: {revdate})


== Descarga App y Creacion de Identidad

Los departamentos de marketing de Alastria y de la empresa de ticketing envian correos a las personas registradas en el evento, a las direcciones de correo que proporcionaron en el momento del registro.

El correo proporciona instrucciones para que se descargen la aplicacion.

Los usuarios se registran en la aplicacion *en local*, sin ninguna interaccion con ningun servidor. El proceso incluye la creacion de su AlastriaID.

A partir de ese momento, el usuario puede entra en su aplicacion proporcionando la contraseÃ±a (no hace falta el usuario), para poder operar con ella.

ifdef::env-github[image::descarga-aplicacion.png[Creacion identidad]]
ifndef::env-github[]
[plantuml,descarga-aplicacion,png]
....

@startuml
autonumber
skinparam sequenceArrowThickness 2
skinparam roundcorner 10
skinparam maxmessagesize 150


participant "Ticketing marketing" as TM
box "Usuario" #LightCyan
  actor Usuario as U
  participant "Movil" as M
end box

TM -> M: Email con URL descarga

U -> M: Descarga App
M -> M: Muestra formulario registro local
U -> M: Email, Nombre, Apellidos
U -> M: ContraseÃ±a acceso local (integrado con huella dactilar)

U -> M: Click boton Genera AlastriaID
M -> M: Genera Claves Publica + Privada y DID

M -> M: Guardar en local todos los datos

@enduml

....
endif::[]


== Obtencion de Credencial

Este flujo es independiente del anterior, pero se puede realizar a continuacion.

Aqui es donde el usuario envia una peticion de creacion de Credencial al sevidor de Ticketing.

ifdef::env-github[image::creacion-identidad.png[Creacion identidad]]
ifndef::env-github[]
[plantuml,creacion-identidad,png]
....

@startuml
autonumber
skinparam sequenceArrowThickness 2
skinparam roundcorner 10
skinparam maxmessagesize 150

box "Usuario" #LightCyan
  actor Usuario as U
  participant "Movil" as M
end box

box "Ticket company" #LightCyan
  participant "Ticketing" as T
  database "BBDD" as D
end box

U -> M: Click "Obtener credencial"
M -> T: requestCredential(email)

T -> D: Consulta datos asociados a email
T -> T: Genera Hash (email+ticketID)
T -> M: Email con link + Hash
U -> M: Lee email y click en link
M -> M: Muestra pantalla de confirmacion

U -> M: Click OK

M -> T: getCredential(DID,Nombre,email)

T -> D: Consulta por email
return ticketID, Nombre

T -> T: Verifica Hash recibido
T -> T: Crea la Credencial

T -> M: Credencial(DID,ticketID)
M -> M: Muestra pantalla confirmacion

U -> M: Click OK
M -> M: Guarda Credencial


@enduml
....
endif::[]


